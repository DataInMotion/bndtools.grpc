# bndtools.grpc
Bndtools support for gRPC (Google RPC)

This repo defines a plugin for bndtools 5.x that will:

1. Generate [gRPC (Google RPC)](https://grpc.io/) java code to be used as the API for an OSGi Service or OSGi Remote Service
2. Initiate the code generation as part of the new bndtools -generate support](https://bnd.bndtools.org/instructions/generate.html), which will do the code generation as part of the Eclipse-initiated auto-or-user-controlled bndtools builds.

The developer workflow is to simply 

1. Create a proto file, with a service declaration [service declaration](https://developers.google.com/protocol-buffers/docs/proto3#services) and any protocol buffers declarations needed for request types and/or response types [proto3 syntax](https://developers.google.com/protocol-buffers/docs/proto3).

2.  Add that .proto file to a new bndtools project and add the appropriate bndtools -generate command to the bnd.bnd project file

When both of these are done, the bndtools -generate command will be invoked, triggering immediate java code generation for the following:

a. Classes corresponding to any/all request+response protocol buffers declarations
b. gRPC classes generated by the gRPC compiler (for use by gRPC servers and/or clients)
c. A java interface class for each service declaration in the proto file.  This service interface can be used as the service API for OSGi services and remote services

The code generation is completely redone when any change is made to the proto3 file, meaning that starting with a proto file a complete service API will be immediately and automatically generated, compiled, and packaged into a jar by bndtools without additional developer actions.

## Example

[org.eclipse.ecf.bndtools.grpc.test](https://github.com/ECF/bndtools.grpc/tree/master/org.eclipse.ecf.bndtools.grpc.test) is an example of the bndtools plugin in project [org.eclipse.ecf.bndtools.grpc](https://github.com/ECF/bndtools.grpc/tree/master/)).  

The example has a [health.proto](https://github.com/ECF/bndtools.grpc/blob/master/org.eclipse.ecf.bndtools.grpc.test/proto/health.proto) file, which is an enhanced version of the [grpc-java health example proto3 service](https://github.com/grpc/grpc-java/tree/master/services/src/main/proto/grpc/health/v1).  For the test project this implements part 1 of the above-described developer workflow.

For part 2 of the developer workflow, the org.eclipse.ecf.bndtools.grpc.test project has the -generate command added to the [project's bnd.bnd file](https://github.com/ECF/bndtools.grpc/blob/master/org.eclipse.ecf.bndtools.grpc.test/bnd.bnd) project file.

Here is a copy of this generate command 

```
-generate \
    proto; \
        output = src-gen; \
        generate = "org.eclipse.ecf.bndtools.grpc.GrpcGenerator -I=proto --java_out=src-gen health.proto 2>errors"
 ```



An example of this workflow is included in this repobelow.
